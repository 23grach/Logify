# Logify Plugin Tests

Этот каталог содержит функциональные тесты для Figma плагина Logify.

## Установка

Установите зависимости для тестирования:

```bash
npm install
```

## Запуск тестов

### Все тесты
```bash
npm test
```

### Тесты с отслеживанием изменений
```bash
npm run test:watch
```

### Тесты с покрытием кода
```bash
npm run test:coverage
```

## Структура тестов

### `plugin.test.ts`
Основные функциональные тесты, покрывающие:

1. **Инициализация плагина**
   - Запуск UI
   - Первичная настройка

2. **Хранение и получение данных**
   - Работа с пустым хранилищем
   - Обработка chunked данных

3. **Сбор элементов**
   - Компоненты с страниц
   - Различные типы стилей

4. **Определение изменений**
   - Новые элементы
   - Удаленные элементы
   - Измененные элементы

5. **Валидация данных**
   - Правильная структура элементов
   - Неправильные данные
   - Структура изменений

6. **Hash функции**
   - Консистентность хешей
   - Различие для разных данных

7. **Обработка свойств компонентов**
   - Variant properties
   - Component sets

8. **Сценарии ошибок**
   - Отсутствующие данные
   - Некорректный JSON
   - Ошибки API

9. **Обработка UI сообщений**
   - Типы сообщений
   - Валидация данных

10. **Сжатие данных**
    - Компрессия элементов
    - Декомпрессия

11. **Временные метки**
    - Сохранение modifiedAt
    - Обновление timestamps

### `setup.ts`
Настройка тестовой среды:
- Кастомные Jest matchers
- Мокирование console методов
- Глобальные настройки

## Что тестируется

### ✅ Покрыто тестами:
- Инициализация и настройка
- Сбор элементов дизайн-системы
- Алгоритмы сравнения изменений
- Валидация данных
- Hash функции
- Обработка ошибок
- Сжатие/распаковка данных
- Временные метки

### ❌ Требует дополнительного тестирования:
- Интеграция с реальным Figma API
- Создание UI элементов в Figma
- Производительность на больших объемах данных
- Взаимодействие между пользователями

## Моки (Mocks)

Тесты используют моки для:
- Figma API (`figma.root`, `figma.ui`, etc.)
- Методы создания элементов UI
- Загрузка шрифтов и стилей
- Навигация по страницам

## Кастомные Matchers

### `toBeValidElement()`
Проверяет, является ли объект валидным элементом дизайн-системы.

### `toHaveValidChanges()`
Проверяет, имеет ли объект правильную структуру изменений.

## Запуск отдельных тестов

```bash
# Только тесты инициализации
npm test -- --testNamePattern="Plugin Initialization"

# Только тесты хранения данных
npm test -- --testNamePattern="Data Storage"

# Только тесты определения изменений
npm test -- --testNamePattern="Change Detection"
```

## Отладка тестов

Для отладки конкретного теста:

```bash
npm test -- --testNamePattern="название теста" --verbose
```

## Добавление новых тестов

При добавлении новой функциональности в плагин:

1. Добавьте соответствующие тесты в `plugin.test.ts`
2. Обновите моки если нужно
3. Запустите `npm run test:coverage` для проверки покрытия
4. Убедитесь, что все тесты проходят

## Покрытие кода

Цель - поддерживать покрытие кода выше 80% для всех критически важных функций. 